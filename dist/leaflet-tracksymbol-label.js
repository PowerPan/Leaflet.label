/*
	leaflet-tracksymbol-label, a plugin that adds labels leaflet-trackmarkers for Leaflet powered maps. Based on Leaflet.label
	(c) 2016, Johannes Rudolph

 	https://github.com/PowerPan/leaflet-tracksymbol-label
	https://github.com/Leaflet/Leaflet.label
	http://leafletjs.com
	https://github.com/PowerPan
*/
!function(t,i){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),"undefined"!=typeof i&&i.L&&(i.LeafletTracksymbolLabel=t(L))}(function(t){t.tracksymbolLabelVersion="1.0.0";var i=t.Class.extend({includes:t.Mixin.Events,options:{className:"",clickable:!1,direction:"left",noHide:!0,offset:[12,-15],opacity:1,zoomAnimation:!0},initialize:function(i,e){t.setOptions(this,i),this._source=e,this._animated=t.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(i){this._map=i,this._pane=this.options.pane?i._panes[this.options.pane]:this._source instanceof t.Marker?i._panes.markerPane:i._panes.popupPane,this._container||this._initLayout(),this._pane.appendChild(this._container),this._initInteraction(),this._update(),this.setOpacity(this.options.opacity),i.on("moveend",this._onMoveEnd,this).on("viewreset",this._onViewReset,this),this._animated&&i.on("zoomanim",this._zoomAnimation,this),t.Browser.touch&&!this.options.noHide&&(t.DomEvent.on(this._container,"click",this.close,this),i.on("click",this.close,this))},isOnMap:function(){return this._map?!0:!1},onRemove:function(t){this._pane.removeChild(this._container),t.off({zoomanim:this._zoomAnimation,moveend:this._onMoveEnd,viewreset:this._onViewReset},this),this._removeInteraction(),this._map=null},setLatLng:function(i){return this._latlng=t.latLng(i),this._map&&this._updatePosition(),this},setContent:function(t){return this._previousContent=this._content,this._content=t,this._updateContent(),this},close:function(){var i=this._map;i&&(t.Browser.touch&&!this.options.noHide&&(t.DomEvent.off(this._container,"click",this.close),i.off("click",this.close,this)),i.removeLayer(this))},updateZIndex:function(t){this._zIndex=t,this._container&&this._zIndex&&(this._container.style.zIndex=t)},setOpacity:function(i){this.options.opacity=i,this._container&&t.DomUtil.setOpacity(this._container,i)},_initLayout:function(){this._container=t.DomUtil.create("div","leaflet-tracksymbol-label "+this.options.className+" leaflet-zoom-animated"),this.updateZIndex(this._zIndex)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updatePosition(),this._container.style.visibility="")},_updateContent:function(){this._content&&this._map&&this._prevContent!==this._content&&"string"==typeof this._content&&(this._container.innerHTML=this._content,this._prevContent=this._content,this._labelWidth=this._container.offsetWidth)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},_setPosition:function(i){var e=this._map,n=this._container,o=e.latLngToContainerPoint(e.getCenter()),s=e.layerPointToContainerPoint(i),a=this.options.direction,l=this._labelWidth,h=t.point(this.options.offset);"right"===a||"auto"===a&&s.x<o.x?(t.DomUtil.addClass(n,"leaflet-tracksymbol-label-right"),t.DomUtil.removeClass(n,"leaflet-tracksymbol-label-left"),i=i.add(h)):(t.DomUtil.addClass(n,"leaflet-tracksymbol-label-left"),t.DomUtil.removeClass(n,"leaflet-tracksymbol-label-right"),i=i.add(t.point(-h.x-l,h.y))),t.DomUtil.setPosition(n,i)},_zoomAnimation:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPosition(i)},_onMoveEnd:function(){this._animated&&"auto"!==this.options.direction||this._updatePosition()},_onViewReset:function(t){t&&t.hard&&this._update()},_initInteraction:function(){if(this.options.clickable){var i=this._container,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];t.DomUtil.addClass(i,"leaflet-clickable"),t.DomEvent.on(i,"click",this._onMouseClick,this);for(var n=0;n<e.length;n++)t.DomEvent.on(i,e[n],this._fireMouseEvent,this)}},_removeInteraction:function(){if(this.options.clickable){var i=this._container,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];t.DomUtil.removeClass(i,"leaflet-clickable"),t.DomEvent.off(i,"click",this._onMouseClick,this);for(var n=0;n<e.length;n++)t.DomEvent.off(i,e[n],this._fireMouseEvent,this)}},_onMouseClick:function(i){this.hasEventListeners(i.type)&&t.DomEvent.stopPropagation(i),this.fire(i.type,{originalEvent:i})},_fireMouseEvent:function(i){this.fire(i.type,{originalEvent:i}),"contextmenu"===i.type&&this.hasEventListeners(i.type)&&t.DomEvent.preventDefault(i),"mousedown"!==i.type?t.DomEvent.stopPropagation(i):t.DomEvent.preventDefault(i)}});return t.Map.include({showTracklayerLabel:function(t){return this.addLayer(t)}}),t.Path.include({bindTracksymbolLabel:function(t,e){return this.tracksymbollabel&&this.tracksymbollabel.options===e||(this.tracksymbollabel=new i(e,this)),this.tracksymbollabel.setContent(t),this},unbindTracksymbolLabel:function(){return this.tracksymbollabel&&(this._hideTracksymbolLabel(),this.tracksymbollabel=null),this},updateTracksymbolLabelContent:function(t){this.tracksymbollabel&&("string"==typeof t&&""!==t?(this.tracksymbollabel.isOnMap()||this._showTracksymbolLabel(),this.tracksymbollabel.setContent(t)):this.tracksymbollabel.isOnMap()&&this._hideTracksymbolLabel())},_showTracksymbolLabel:function(){this._map&&this._map.showTracklayerLabel(this.tracksymbollabel)},updateTracksymolLabelLatLng:function(t){this.tracksymbollabel.setLatLng(t)},_hideTracksymbolLabel:function(){this.tracksymbollabel.close()}}),i},window);